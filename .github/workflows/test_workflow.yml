name: "Test Service"

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  test-service:
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ§‘â€ğŸ’» Checkout"
        uses: actions/checkout@v5
        with:
          submodules: true
      - name: "Run Service"
        uses: YunaBraska/email-html-validator@main
      - name: "â™»ï¸ Restore cache [unix-build-${{ hashFiles('**/pom.xml', '**/build.gradle*') }}]"
        id: "cache_build"
        uses: actions/cache@v4
        with:
          path: |
            ~/.m2
            ~/.gradle/caches
            ~/.gradle/wrapper
            ~/.cache/ms-playwright
          key: unix-build-${{ hashFiles('**/pom.xml', '**/build.gradle*') }}
          restore-keys: unix-build-${{ hashFiles('**/pom.xml', '**/build.gradle*') }}
      - name: "ğŸ” Read Java Info"
        id: "java_info"
        uses: YunaBraska/java-info-action@main
      - name: "â˜• Setup Java [${{ steps.java_info.outputs.java_version }}] Builder [${{ steps.java_info.outputs.builder_name }}] [${{ steps.java_info.outputs.builder_version }}]"
        uses: actions/setup-java@main
        with:
          java-version: ${{ steps.java_info.outputs.java_version }}
          distribution: 'temurin'
      - name: "ğŸ§± Install Playwright system dependencies"
        if: ${{ steps.cache_build.outputs.cache-hit != 'true' }}
        run: |
          ${{ steps.java_info.outputs.cmd }} -B -q exec:java -e -D exec.mainClass=com.microsoft.playwright.CLI -D exec.args="install --with-deps"
      - name: "ğŸ§ª Build & Test"
        run: ${{ steps.java_info.outputs.cmd_test_build }}
        env:
          GITHUB_USER: 'GithubBot'
          GITHUB_TOKEN: ${{ secrets.BOT_TOKEN || secrets.GITHUB_TOKEN }}
      - name: "ğŸ—’ï¸ Maven License Info"
        id: "license_info"
        uses: YunaBraska/maven-license-info-action@main
        with:
          exclude-scopes: 'test,provided,system'
          output-dir: 'docs/licenses'

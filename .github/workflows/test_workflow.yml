name: "Test Service"

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  test-service:
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ§‘â€ğŸ’» Checkout"
        uses: actions/checkout@v3
      - name: "ğŸ§± Install Playwright system dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libgtk-3-0 \
            libgtk-4-1 \
            libgraphene-1.0-0 \
            libwoff1 \
            libevent-2.1-7 \
            libopus0 \
            libgstreamer1.0-0 \
            libgstreamer-gl1.0-0 \
            libgstreamer-plugins-base1.0-0 \
            gstreamer1.0-plugins-good \
            gstreamer1.0-plugins-bad \
            gstreamer1.0-libav \
            libflite1 \
            libharfbuzz-icu0 \
            libsecret-1-0 \
            libhyphen0 \
            libmanette-0.2-0 \
            libgles2 \
            libx264-164 \
            libavif16 \
            libvpx9
      - name: "Run Service"
        uses: YunaBraska/email-html-validator@main
      - name: "â™»ï¸ Restore cache [unix-build-${{ hashFiles('**/pom.xml', '**/build.gradle*') }}]"
        uses: actions/cache@v4
        with:
          path: |
            ~/.m2
            ~/.gradle/caches
            ~/.gradle/wrapper
            ~/.cache/ms-playwright
          key: unix-build-${{ hashFiles('**/pom.xml', '**/build.gradle*') }}
          restore-keys: unix-build-${{ hashFiles('**/pom.xml', '**/build.gradle*') }}
      - name: "ğŸ” Read Java Info"
        id: "java_info"
        uses: YunaBraska/java-info-action@main
      - name: "â˜• Setup Java [${{ steps.java_info.outputs.java_version }}] Builder [${{ steps.java_info.outputs.builder_name }}] [${{ steps.java_info.outputs.builder_version }}]"
        uses: actions/setup-java@main
        with:
          java-version: ${{ steps.java_info.outputs.java_version }}
          distribution: 'temurin'
      - name: "ğŸ§ª Build & Test"
        run: ${{ steps.java_info.outputs.cmd_test_build }}
        env:
          GITHUB_USER: 'GithubBot'
          GITHUB_TOKEN: ${{ secrets.BOT_TOKEN || secrets.GITHUB_TOKEN }}
      - name: "ğŸ—’ï¸ Maven License Info"
        id: "license_info"
        uses: YunaBraska/maven-license-info-action@main
        with:
          exclude-scopes: 'test,provided,system'
          output-dir: 'docs/licenses'
